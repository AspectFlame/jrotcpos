<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/theme.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <h2>All orders</h2>
            </div>
        </div>
        <div class="row" id="display_orders">
        </div>
    </div>
</body>
<script>
    $(document).ready(function () {                    
        getAllOrders();
    });

    function getAllOrders() {
        orders = {};
        $.ajax({
            url: "http://localhost:5001/get_order_info",
            context: this,
            method: "post",
            dataType: "json",
            data: { 'confirmed' : true}
        }).done(function (data, status) {
            items = data;
            for (item of items) {
                // instead of just dealing with an array of values, it will be nice to deal with a json object so you know what array[5] represents
            // so in the loop below if you can push an object into the orders like so..
            // ideally you want to make an array of objects for each recipient containing all the order info 
            // and then an array of objects for customer containing all the recipient objects u created in the prev line for that customer
            // so orderinfo parent object will look like this for eg.
            /*
            {
                "orderid" : 123,
                "customeremail" : "shy@test.com",
                "recipients" : [
                        { "orderid" : 33,
                            "recipientemail" : "kk@test.com",
                        "orderdetails" : [
                            {
                            "orderdetailid" : 5,
                            "product" : "white carnation",
                            "qty" : 5
                            },
                            {
                                "orderdetailid" : 6,
                                "product" : "red carnation",
                                "qty" : 4
                            }
                        ]  
                        },
                        "orderid" : 34,
                            "recipientemail" : "aa@test.com",
                        "orderdetails" : [
                            {
                            "orderdetailid" : 15,
                            "product" : "white carnation",
                            "qty" : 5
                            },
                            {
                                "orderdetailid" : 16,
                                "product" : "red carnation",
                                "qty" : 4
                            }
                        ]  
                ]
            }
            */

            // so then u will be passing the entire object to the generate card method and 
            // for each order id, you will iterate through the recipients object array 
            // and you can have access to the properties inside the object. 
            // it is more intuitive like that and easier to understand later as well
            // can you first build the object like I have shown above
            // once u build the object you set it in local storage so you can see how it looks for debugging

            // orders
                if (orders[item[0]]) {
                    orders[item[0]].push(item)
                } else {
                    orders[item[0]] = [item]
                }
            }
            for (let [key, value] of Object.entries(orders)) {
                $('#display_orders').append(generateCard(value));
            }
        });
    }



    function generateCard(array) {
        cardsHtml = '<div class="col-4 mb-2">';
        cardsHtml += '<div class="card h-100">';
        cardsHtml += '<div class="card-header"><b>Customer email: </b>' + array[0][1] + '<br><b>Recipient Name and Email: </b>' + array[0][3] + ' ' + array[0][4] + ', ' + array[0][5] + '<br><b>Recipient Schedule: </b>' + array[0][6] + ', ' + array[0][7] + ', ' + array[0][8] + ', ' + array[0][9] + ', ' + array[0][10] + ', ' + array[0][11] + ', ' + array[0][12] + ', ' + array[0][13] +'</div>';
        cardsHtml += '<div class="card-body"><p class="mb-2">' + array[0][2] + '</p>';
        
        //i dont know how to make it show each recipients email on the page. If you look at the side monitor on the very bottom, you can see that it
        //shows how many of each carnation but only shows one email but has all the quantities. I was trying to figure out how to fix that.
        //one solution for me was to add 'detail[5]' right below here. The issue with that was it that it showed the email for each red carnation, white
        // carnation, and pink carnation. If you don't want to write it out for me, can you explain how to do it? thx


        for (detail of array) {
            cardsHtml += '<p class="mb-0">' + detail[14] + ' x' + detail[15] + '</p>'; 
        }
        cardsHtml += '</div>';
        cardsHtml += '</div></div>';
        return cardsHtml;

        
    }
</script>
</html>